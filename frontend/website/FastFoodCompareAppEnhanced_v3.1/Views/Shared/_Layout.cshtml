@using FastFoodCompareAppEnhanced_v3_1
@using FastFoodCompareAppEnhanced_v3_1.Models
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Fast Food Compare</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <link href="~/css/site.css" rel="stylesheet" />
    <link href="~/css/auth.css" rel="stylesheet" />

    <style>
    
        /* CSS C·ª¶A B·∫†N (Gi·ªØ nguy√™n) */
        body::-webkit-scrollbar {
    width: 8px; /* Chi·ªÅu r·ªông c·ªßa thanh cu·ªôn d·ªçc */
    height: 8px; /* Chi·ªÅu cao c·ªßa thanh cu·ªôn ngang */
}

/* Background c·ªßa khu v·ª±c thanh cu·ªôn */
body::-webkit-scrollbar-track {
    background: #f1f1f1; /* M√†u n·ªÅn c·ªßa r√£nh cu·ªôn (track) */
    border-radius: 10px; /* Bo g√≥c cho r√£nh */
}

/* Thanh tr∆∞·ª£t (thumb) */
body::-webkit-scrollbar-thumb {
    background: #ff6a00; /* M√†u c·ªßa thanh tr∆∞·ª£t (M√†u cam c·ªßa b·∫°n) */
    border-radius: 10px; /* Bo g√≥c cho thanh tr∆∞·ª£t */
}

/* Khi hover l√™n thanh tr∆∞·ª£t */
body::-webkit-scrollbar-thumb:hover {
    background: #e55c00; /* M√†u ƒë·∫≠m h∆°n khi hover */
}
        .user-avatar {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #ff6a00;
            color: #ffffff;
            font-weight: 600;
            font-size: 1rem;
        }

        /* CSS CHO BACKGROUND V√Ä C·∫§U TR√öC CH√çNH */
        body {
            font-family: 'QuickSand', cursive, sans-serif;
            background-image: url('/images/BackGround1.jpg'); 
            background-size: cover;      
            background-repeat: no-repeat; 
            background-attachment: fixed; 
            background-position: center center;
        }
        .navbar {
            background-color: #ffffff !important; 
        }
        
        /* B·ªî SUNG CSS M·ªöI ƒê·ªÇ CƒÇN S√ÅT L·ªÄ TR√ÅI V√Ä C√ÅCH 10PX */
        .navbar .container-fluid {
            /* ƒê·∫£m b·∫£o n·ªôi dung navbar ƒë∆∞·ª£c cƒÉn s√°t l·ªÅ tr√°i */
            padding-left: 10px !important; 
            padding-right: 15px !important; /* Gi·ªØ padding ph·∫£i m·∫∑c ƒë·ªãnh */
        }
        .navbar-brand {
            /* B·ªè margin-left m·∫∑c ƒë·ªãnh (n·∫øu c√≥) v√† cƒÉn ch·ªânh */
            margin-left: 0 !important;
            padding-left: 0 !important;
        }

        /* HI·ªÜU ·ª®NG HOVER M√ÄU V√ÄNG CHO C√ÅC N√öT NAV BAR */
        .navbar .btn-outline-primary:hover,
        .navbar .btn-outline-secondary:hover {
            color: #000 !important; /* Ch·ªØ ƒëen */
            background-color: #ffc107; /* M√†u v√†ng (Bootstrap Warning) */
            border-color: #020202; /* Vi·ªÅn c√πng m√†u */
            opacity: 0.9;
        }
        /* ƒê·∫£m b·∫£o n√∫t ƒêƒÉng xu·∫•t v·∫´n c√≥ hover m√†u ƒë·ªè */
        .navbar .btn-danger:hover {
            background-color: #c82333 !important; 
            border-color: #bd2130 !important;
            color: #fff !important;
            opacity: 1;
        }
        
        /* KHUNG N·ªòI DUNG CH√çNH ·ªû GI·ªÆA M√ÄN H√åNH */
        .main-content-container {
            margin:20px;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); 
            padding: 30px; 
            margin-top: 30px; 
            margin-bottom: 30px;
            margin-right: 30px;
        }
        
        /* ƒêi·ªÅu ch·ªânh cho layout 2 c·ªôt tr√™n trang Menu n·∫øu c·∫ßn */
        .page-content-wrapper {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .col-right-panel {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px; 
            padding: 20px;
            position: fixed; 
            top: 80px; 
            right: 20px;
            width: 350px; 
            height: 350px;
            max-height: calc(100vh - 100px);
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto; 
            z-index: 1000; 
        }
        .col-left-panel-wrapper {
            margin-right: 10px; 
            min-height: 100vh; 
        }
        .col-left-panel {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px; 
            padding: 30px;
            left: 0;
            right: 10px; 
            position: flex; 
        }
        .navbar-logo {
        height: 45px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh 10px */
        width: 45px;  /* Chi·ªÅu r·ªông c·ªë ƒë·ªãnh 10px */
        margin-right: 8px; 
        vertical-align: middle; 
        }
        .footer-wrapper-white { 
            background-color: #dbcb9c; /* N·ªÅn tr·∫Øng */
            border-radius: 12px; /* Bo g√≥c */
            padding: 15px; /* Padding b√™n trong */
            bottom: 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* B√≥ng ƒë·ªï nh·∫π */
            text-align: left;
            width: 100%; /* ƒê·∫£m b·∫£o chi·ªÅu r·ªông ƒë·∫ßy ƒë·ªß */
            position: absolute; /* Ho·∫∑c 'absolute' */
            z-index: 0;
        }
        .btn-sweep {
            position: relative; /* Quan tr·ªçng: ƒê·ªÉ pseudo-element ƒë·ªãnh v·ªã t∆∞∆°ng ƒë·ªëi */
            overflow: hidden; /* C·∫Øt b·ªõt ph·∫ßn m√†u d∆∞ ra ngo√†i n√∫t */
            z-index: 1; /* ƒê·∫£m b·∫£o ch·ªØ n·∫±m tr√™n m√†u n·ªÅn m·ªõi */
            transition: color 0.3s ease-in-out; /* Chuy·ªÉn m√†u ch·ªØ m∆∞·ª£t m√† */
        }

        .btn-sweep::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0; /* B·∫Øt ƒë·∫ßu t·ª´ m√©p ph·∫£i */
            height: 100%;
            width: 0; /* Chi·ªÅu r·ªông ban ƒë·∫ßu l√† 0 */
            background-color: #ff6a00; /* M√†u n·ªÅn khi hover (V√≠ d·ª•: M√†u cam) */
            z-index: -1; /* ƒê·∫£m b·∫£o n√≥ n·∫±m d∆∞·ªõi ch·ªØ */
            
            /* Transition cho hi·ªáu ·ª©ng sweep */
            transition: width 0.3s ease-in-out; 
        }

        /* === KHI HOVER: M·ªü r·ªông width c·ªßa pseudo-element v√† ƒë·ªïi m√†u ch·ªØ === */
        .btn-sweep:hover::before {
            width: 100%; /* M·ªü r·ªông to√†n b·ªô n√∫t */
            right: 0; 
        }

        .btn-sweep:hover {
            color: #ffffff !important; /* ƒê·ªïi m√†u ch·ªØ sang tr·∫Øng khi hover */
            border-color: #ff6a00 !important; /* ƒê·ªïi m√†u border khi hover */
        }
    
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
        <div class="container-fluid"> 
            <a class="navbar-brand" href="/">
                <img src="/images/Logo.jpg" alt="" class="navbar-logo ">
                FastFoobCompany
            </a>
            <div class="ms-auto d-flex align-items-center">
                
                <a href="@Url.Action("Index","Cart")" class="btn btn-outline-primary btn-sm me-3 rounded-pill">
                    üõí Gi·ªè 
                </a>

                <div class="d-flex align-items-center d-none" id="user-logged-in-state">
                    
                    <span class="d-flex align-items-center me-3">
                        <span class="user-avatar me-2" id="user-avatar-initial"></span>
                        <strong id="user-display-name"></strong>
                    </span>
                    
                    <a class="btn btn-outline-secondary btn-sm me-2 d-none d-lg-block rounded-pill btn-sweep" href="@Url.Action("Profile", "Account")">
                        L·ªãch s·ª≠ ƒê∆°n h√†ng
                    </a>
                                            
                    <a class="btn btn-outline-secondary btn-sm me-3 d-none d-lg-block rounded-pill btn-sweep" href="@Url.Action("Profile", "Account")">
                        C·∫≠p nh·∫≠t T√†i kho·∫£n
                    </a>
                                            
                    <button class="btn btn-sm btn-danger rounded-pill btn-sweep" id="logout-button">
                        ƒêƒÉng xu·∫•t
                    </button>
                </div>

                <div id="user-logged-out-state" class="d-flex align-items-center">
                    <a href="@Url.Action("Login","Account")" class="btn btn-outline-primary btn-sm me-2 rounded-pill">ƒêƒÉng nh·∫≠p</a>
                    <a href="@Url.Action("Register","Account")" class="btn btn-gradient btn-sm rounded-pill">ƒêƒÉng k√Ω</a>
                </div>

            </div>
        </div>
    </nav>
    
    <div class="container-fluid">
        @RenderBody()
    </div>

    <div class="footer-wrapper-white">
        @await Component.InvokeAsync("FastFoodFooter") 
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Khai b√°o h·∫±ng s·ªë
        const MENU_LOGIN_URL = '@Url.Action("Login", "Account")'; 
        const CART_ADD_API_URL = 'https://localhost:7132/api/Cart/add';

        // =================================================================
        // H√ÄM T·∫¢I S·ªê L∆Ø·ª¢NG GI·ªé H√ÄNG T·ª™ API (Cho Navbar)
        // =================================================================

        window.loadCartCount = async function (user) {
            const cartCountSpan = document.getElementById("cartCount");
            
            if (!user) {
                if(cartCountSpan) cartCountSpan.textContent = 0;
                return;
            }

            const apiUrl = `https://localhost:7132/api/Cart/${user}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: { 'accept': 'text/plain' }
                });

                if (!response.ok) {
                    console.error("L·ªói khi t·∫£i gi·ªè h√†ng t·ª´ API:", response.status, response.statusText);
                    if(cartCountSpan) cartCountSpan.textContent = 0; 
                    return;
                }

                const cartData = await response.json();
                
                const totalItems = cartData.items ? 
                                             cartData.items.reduce((total, item) => total + (item.quantity || 0), 0) : 
                                             0;

                if (cartCountSpan) {
                    cartCountSpan.textContent = totalItems;
                }

            } catch (error) {
                console.error('L·ªói k·∫øt n·ªëi ho·∫∑c x·ª≠ l√Ω JSON:', error);
                if(cartCountSpan) cartCountSpan.textContent = 0; 
            }
        }
        
        // =================================================================
        // LOGIC KH·ªûI T·∫†O V√Ä G·∫ÆN S·ª∞ KI·ªÜN (Ch·∫°y khi DOM t·∫£i xong)
        // =================================================================

        document.addEventListener("DOMContentLoaded", function () {
            
            const loggedInState = document.getElementById("user-logged-in-state");
            const loggedOutState = document.getElementById("user-logged-out-state");
            const displayNameSpan = document.getElementById("user-display-name");
            const avatarSpan = document.getElementById("user-avatar-initial"); 
            // L·∫•y th·∫ª a gi·ªè h√†ng ƒë·ªÉ ch√®n span ƒë·∫øm s·ªë l∆∞·ª£ng
            const cartLink = document.querySelector('a[href="@Url.Action("Index","Cart")"]'); 

            const username = localStorage.getItem("username"); 

            // --- Logic Navbar (·∫®n/Hi·ªán UI d·ª±a tr√™n tr·∫°ng th√°i ƒëƒÉng nh·∫≠p) ---
            if (username) {
                // ƒê√£ ƒëƒÉng nh·∫≠p: Hi·ªÉn th·ªã t√™n v√† avatar, ·∫©n n√∫t ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω
                if(displayNameSpan) displayNameSpan.textContent = username; 
                if(avatarSpan && username.length > 0) avatarSpan.textContent = username.charAt(0).toUpperCase();
                
                if(loggedInState) loggedInState.classList.remove("d-none"); ¬†// HI·ªÜN KH·ªêI LOGGED IN
                if(loggedOutState) loggedOutState.classList.add("d-none"); // ·∫®N KH·ªêI LOGGED OUT
                
                if(cartLink) {
                    // C·∫≠p nh·∫≠t link gi·ªè h√†ng c√≥ s·ªë ƒë·∫øm
                    cartLink.innerHTML = `üõí Gi·ªè (<span id="cartCount">0</span>)`;
                }
            } else {
                // Ch∆∞a ƒëƒÉng nh·∫≠p: ·∫®n kh·ªëi user, hi·ªán n√∫t ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω
                if(loggedInState) loggedInState.classList.add("d-none"); ¬† // ·∫®N KH·ªêI LOGGED IN
                if(loggedOutState) loggedOutState.classList.remove("d-none"); // HI·ªÜN KH·ªêI LOGGED OUT
                
                if(cartLink) {
                    // C·∫≠p nh·∫≠t link gi·ªè h√†ng kh√¥ng s·ªë ƒë·∫øm
                    cartLink.innerHTML = `üõí Gi·ªè`;
                }
            }

            // üéØ G·ªçi h√†m t·∫£i s·ªë l∆∞·ª£ng gi·ªè h√†ng
            window.loadCartCount(username); 

            // --- X·ª≠ l√Ω n√∫t ƒêƒÉng xu·∫•t ---
            const logoutButton = document.getElementById("logout-button");
            if(logoutButton) {
                logoutButton.addEventListener("click", function (e) {
                    e.preventDefault(); 
                    localStorage.removeItem("username");
                    localStorage.removeItem("jwtToken"); 
                    localStorage.removeItem("frontend_cart"); 
                    localStorage.removeItem("CART_ITEMS"); 
                    window.location.href = MENU_LOGIN_URL;
                });
            }
        });
    </script>
    
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>