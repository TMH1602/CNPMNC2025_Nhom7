@{
    ViewData["Title"] = "Thông tin người dùng";
}

<style>
    /* Avatar nhỏ cho sidebar */
    .sidebar-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background-color: #ff6a00;
        color: #ffffff;
        font-weight: 600;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Avatar lớn cho phần nội dung */
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: #ff6a00;
        color: #ffffff;
        font-weight: 600;
        font-size: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
    }

    /* Tùy chỉnh nav-link cho sidebar */
    .profile-sidebar .nav-link {
        color: #555;
        padding-top: 12px;
        padding-bottom: 12px;
    }

    .profile-sidebar .nav-link.active {
        color: #ff6a00; /* Màu cam */
        background-color: transparent;
        border-right: 3px solid #ff6a00;
        font-weight: 600;
    }
</style>

<div id="message-panel" class="mb-3"></div>

<div class="row">
    <div class="col-md-3">
        <div class="profile-sidebar">
            <div class="d-flex align-items-center mb-3">
                <div class="sidebar-avatar me-3" id="sidebar-avatar-initial"></div>
                <div>
                    <strong id="sidebar-username" class="d-block">...</strong>
                </div>
            </div>
            
            <hr>

            <nav class="nav nav-pills flex-column">
                <a class="nav-link active" href="@Url.Action("Profile", "Account")">Cập nhật tài khoản</a>
                <a class="nav-link" href="#">Thông tin đơn hàng</a>
                <a class="nav-link" href="#">Phương thức thanh toán</a>
            </nav>
        </div>
    </div>

    <div class="col-md-9">
        <div class="card">
            <div class="card-body p-4">
                
                <h4 class="mb-4">Thông tin người dùng</h4>

                <h5>Tải ảnh đại diện</h5>
                <div class="row mt-3 align-items-center">
                    <div class="col-md-3 text-center">
                        <div class="profile-avatar" id="profile-avatar-initial"></div>
                    </div>
                    <div class="col-md-9">
                        <p class="small text-muted mb-2">Chấp nhận GIF, JPEG, PNG, BMP với kích thước tối đa 5.0 MB</p>
                        <input type="file" class="form-control mb-2" id="avatar-file-input">
                        <button class="btn btn-primary" id="update-avatar-btn">Cập nhật</button>
                    </div>
                </div>

                <hr class="my-4">

                <h5>Thay đổi thông tin</h5>
                <form id="profile-form" class="mt-3">
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">Tên</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="profile-name-input" value="...">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">Giới tính</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="profile-gender-select">
                                <option value="0">Không chọn</option>
                                <option value="1">Nam</option>
                                <option value="2">Nữ</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">Email</label>
                        <div class="col-sm-9">
                            <input type="email" readonly class="form-control-plaintext" id="profile-email-input" value="...">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">Mật khẩu</g label>
                        <div class="col-sm-9">
                            <input type="password" readonly class="form-control-plaintext" value="********">
                            <a href="#" class="ms-2">Đổi mật khẩu</a>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-sm-9 offset-sm-3">
                            <button type="submit" class="btn btn-gradient">Lưu thay đổi</button>
                        </div>
                    </div>
                </form>

                <hr class="my-4">

                <h5>Quản lý số điện thoại</h5>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        <div id="profile-phone-number">...</div>
                        <div class="small text-success" id="profile-phone-status" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                            </svg>
                            Số điện thoại đã được xác thực
                        </div>
                    </div>
                    <button class="btn btn-outline-primary" id="update-phone-btn">Cập nhật số điện thoại</button>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Chạy script khi trang đã tải xong
    document.addEventListener("DOMContentLoaded", function () {
        
        // --- 1. LẤY DỮ LIỆU TỪ LOCALSTORAGE (FRONTEND-ONLY) ---
        const username = localStorage.getItem("username");
        const token = localStorage.getItem("jwtToken"); // Để sẵn cho API

        // Nếu chưa đăng nhập, đá về trang Login
        if (!username || !token) {
            window.location.href = "@Url.Action("Login", "Account")";
            return;
        }

        // Lấy chữ cái đầu
        const firstLetter = username.charAt(0).toUpperCase();

        // --- 2. ĐIỀN DỮ LIỆU VÀO GIAO DIỆN ---
        // Sidebar
        document.getElementById("sidebar-avatar-initial").textContent = firstLetter;
        document.getElementById("sidebar-username").textContent = username;

        // Nội dung chính
        document.getElementById("profile-avatar-initial").textContent = firstLetter;
        document.getElementById("profile-name-input").value = username;
        
        // Đây là các giá trị placeholder. 
        // Sau này, bạn sẽ thay thế chúng bằng dữ liệu từ API.
        document.getElementById("profile-email-input").value = "minhhoangtran1602@gmail.com";
        document.getElementById("profile-phone-number").textContent = "0784224079";
        document.getElementById("profile-phone-status").style.display = "block";


        // --- 3. GẮN SỰ KIỆN "CHỜ" CHO CÁC NÚT (SẴN SÀNG CHO API) ---
        
        // Nút Lưu thay đổi
        document.getElementById("profile-form").addEventListener("submit", function(e) {
            e.preventDefault(); // Ngăn form submit
            
            // Lấy dữ liệu mới
            const newName = document.getElementById("profile-name-input").value;
            const newGender = document.getElementById("profile-gender-select").value;
            
            console.log("Dữ liệu sẵn sàng gửi:", { newName, newGender });
            alert("Đã nhấn Lưu thay đổi! (Sẵn sàng gọi API)");
            
            // SAU NÀY: Bạn sẽ gọi API 'fetch' ở đây
            // fetch("/api/Auth/profile", {
            //    method: "PUT",
            //    headers: { "Authorization": `Bearer ${token}`, "Content-Type": "application/json" },
            //    body: JSON.stringify({ fullName: newName, gender: newGender })
            // })...
        });

        // Nút Cập nhật avatar
        document.getElementById("update-avatar-btn").addEventListener("click", function(e) {
            e.preventDefault();
            const fileInput = document.getElementById("avatar-file-input");
            if (fileInput.files.length > 0) {
                console.log("File sẵn sàng upload:", fileInput.files[0].name);
                alert("Đã chọn file! (Sẵn sàng gọi API upload)");
                // SAU NÀY: Gọi API 'fetch' (dùng FormData) để upload file
            } else {
                alert("Bạn chưa chọn file nào.");
            }
        });
        
        // Nút Cập nhật SĐT
        document.getElementById("update-phone-btn").addEventListener("click", function(e) {
            e.preventDefault();
            alert("Đã nhấn Cập nhật SĐT! (Sẵn sàng gọi API)");
        });
    });
</script>
}